local.verifio.email {
    tls internal

    # Frontend routes (most specific first)
    handle /dashboard* {
        reverse_proxy host.docker.internal:3001 {
            header_up Host {host}
            header_up X-Forwarded-Proto {scheme}
            header_up X-Forwarded-For {remote}
        }
    }
    handle /docs* {
        reverse_proxy host.docker.internal:3003 {
            header_up Host {host}
            header_up X-Forwarded-Proto {scheme}
            header_up X-Forwarded-For {remote}
        }
    }

    # API routes
    handle /api/auth* {
        reverse_proxy host.docker.internal:8000 {
            header_up Host {host}
            header_up X-Forwarded-Proto {scheme}
            header_up X-Forwarded-For {remote}
        }
    }
    handle /api/api-key* {
        reverse_proxy host.docker.internal:8012 {
            header_up Host {host}
            header_up X-Forwarded-Proto {scheme}
            header_up X-Forwarded-For {remote}
        }
    }

    handle /api/analytics* {
        reverse_proxy host.docker.internal:8016 {
            header_up Host {host}
            header_up X-Forwarded-Proto {scheme}
            header_up X-Forwarded-For {remote}
        }
    }
    handle /api/workflow* {
        reverse_proxy host.docker.internal:8017 {
            header_up Host {host}
            header_up X-Forwarded-Proto {scheme}
            header_up X-Forwarded-For {remote}
        }
    }
    handle /api/upload* {
        reverse_proxy host.docker.internal:8018 {
            header_up Host {host}
            header_up X-Forwarded-Proto {scheme}
            header_up X-Forwarded-For {remote}
        }
    }
    handle /api/verify* {
        reverse_proxy host.docker.internal:3040 {
            header_up Host {host}
            header_up X-Forwarded-Proto {scheme}
            header_up X-Forwarded-For {remote}
        }
    }
    # Main app (catch-all - everything else)
    handle {
        reverse_proxy host.docker.internal:3000 {
            header_up Host {host}
            header_up X-Forwarded-Proto {scheme}
            header_up X-Forwarded-For {remote}
        }
    }
}
