---
title: Database Schema
description: Database tables and relationships.
---

# Database Schema

Complete database schema for Verifio using PostgreSQL and Drizzle ORM.

## Database Connection

```typescript
import { db } from "@verifio/db/client";
import * as schema from "@verifio/db/schema";
```

## Tables by Service

### Auth Service

| Table | Purpose |
|-------|---------|
| `user` | User accounts |
| `session` | Active sessions |
| `account` | OAuth connections |
| `organization` | Organizations |
| `member` | Organization memberships |
| `invitation` | Organization invitations |
| `verification` | Email verification tokens |
| `jwks` | Cryptographic keys |

### Verify Service

| Table | Purpose |
|-------|---------|
| `verificationJob` | Bulk verification jobs |
| `verificationResult` | Individual results |

### API Key Service

| Table | Purpose |
|-------|---------|
| `apikey` | API keys with rate limiting |

### Credits Service

| Table | Purpose |
|-------|---------|
| `orgCredits` | Current billing period |
| `creditHistory` | Past billing periods |

### Upload Service

| Table | Purpose |
|-------|---------|
| `upload` | File metadata |

### Logs Service

| Table | Purpose |
|-------|---------|
| `activityLogs` | Activity and audit logs |

## Key Relationships

```
user 1:N session
user 1:N member
organization 1:N member
organization 1:1 orgCredits
organization 1:N apikey
organization 1:N verificationJob
verificationJob 1:N verificationResult
```

## Common Queries

**Get user with organizations:**
```typescript
const user = await db.query.user.findFirst({
  where: eq(schema.user.email, 'user@example.com'),
  with: {
    members: {
      with: {
        organization: true,
      },
    },
  },
});
```

**Get credit status:**
```typescript
const credits = await db.query.orgCredits.findFirst({
  where: eq(schema.orgCredits.organizationId, orgId),
});
```

**Get API key:**
```typescript
const apiKey = await db.query.apikey.findFirst({
  where: eq(schema.apikey.key, hashedKey),
});
```

## Migrations

```bash
# Generate migration
bun run db:generate

# Push schema (development)
bun run db:push

# Run migrations (production)
bun run db:migrate

# View database
bun run db:studio
```

## Schema Location

All schema files in: `packages/db/src/schema/`
